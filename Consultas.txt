---------ENUNCIADOS CONSULTAS (join)---------------

-- 1 Qué taquillas se han dado con un número de acceso a Carlos.
select distinct acceso.numero_taquilla, usuario.nombre_usuario
from acceso, usuario
where acceso.dni_usuario = usuario.dni_usuario
and usuario.nombre_usuario like '%Carlos%';

-- 2 Qué usuarios han hecho una reserva y qué día.
select distinct usuario.nombre_usuario, to_char(reserva.fecha_reserva, 'Day') "Dia"
from usuario,reserva
where usuario.dni_usuario = reserva.dni_usuario;

--está revisada con el número del día (luego lo hablamos).
select distinct usuario.nombre_usuario, to_char(reserva.fecha_reserva, 'dd') "Dia"
from usuario,reserva
where usuario.dni_usuario = reserva.dni_usuario;

-- 3 Sacar del animador Paco en qué eventos ha participado y la fecha cuando tuvo lugar.
select distinct animacion.nombre_animador, evento.nombre_evento,evento.fecha_evento
from animacion,evento, acceso
where evento.fecha_evento = acceso.fecha_acceso
and animacion.nombre_animador like 'Paco%';

-- 4 Qué usuarios han escogido un menú específico en un mes.
select distinct usuario.nombre_usuario, menu.nombre_menu, to_char (acceso.fecha_acceso, 'Day') "Dia"
from usuario, menu, acceso
where usuario.dni_usuario =  acceso.dni_usuario 
and menu.nombre_menu like 'Menu Rojo'
and acceso.fecha_acceso between '01-may-22' and '31-may-22';

--a mi me queda más claro esto y es más reutilizable (volvi a cambiar lo de los días)
select distinct usuario.nombre_usuario, menu.nombre_menu, to_char (acceso.fecha_acceso, 'dd') "Dia"
from usuario, menu, acceso
where usuario.dni_usuario =  acceso.dni_usuario 
and menu.nombre_menu like 'Menu Rojo'
and to_char(acceso.fecha_acceso,'MM') like '05';

-- 5 Que usuarios han accedido mediante reserva a la taquilla. (esta está mal pero el enunciao)
--select distinct usuario.nombre_usuario
--from acceso, usuario, reserva
--where  acceso.dni_usuario = usuario.dni_usuario;

-- 6 Mostrar los usuarios que han tenido un evento en un fecha determinada.
select distinct usuario.nombre_usuario, evento.nombre_evento, evento.numero_sala,evento.fecha_evento
from usuario, evento, acceso
where evento.fecha_evento = acceso.fecha_acceso
and evento.fecha_evento like '12-MAR-22';

--no está bien
--CORREGIDA
select usuario.nombre_usuario, evento.nombre_evento, evento.fecha_evento 
from usuario, evento, asiste
where usuario.dni_usuario = asiste.dni_usuario and asiste.id_evento = evento.id_evento
and evento.fecha_evento like '15-FEB-22';


-- 7 Mostrar la informacion de los monitores que trabajen en la zona de juego denominada 'VOLCAN'.
select distinct personal.nombre_personal, zona_juegos.nombre_zonajuego
from zona_juegos, personal, acceso
where zona_juegos.id_zonajuego = acceso.id_zonajuego
and personal.puesto_personal like 'MONITOR'
and  zona_juegos.nombre_zonajuego like 'VOLCAN';

--CORREGIDA
select distinct personal.nombre_personal, personal.telefono_personal, personal.correo_personal, 
    personal.direccion_personal, zona_juegos.nombre_zonajuego
from zona_juegos, personal, trabaja
where zona_juegos.id_zonajuego = trabaja.id_zonajuego
and trabaja.dni_personal = personal.dni_personal
and personal.puesto_personal like 'MONITOR'
and zona_juegos.nombre_zonajuego like 'VOLCAN';


--8 Mostrar los usuarios del evento 'Cumpleaños Juan'
select distinct usuario.nombre_usuario,evento.nombre_evento
from usuario, evento, acceso
where usuario.dni_usuario = acceso.dni_usuario
and evento.nombre_evento like 'Cumpleaños Juan';

--esta es un puto desastre
--CORREGIDA
select distinct usuario.nombre_usuario,evento.nombre_evento
from usuario, evento, asiste
where usuario.dni_usuario = asiste.dni_usuario
and asiste.id_evento = evento.id_evento
and evento.nombre_evento like 'Cumpleaños Juan';


-------ENUNCIADOS CONSULTAS (agrupadas)---------------

--9 Saca cuantas taquillas han sido seleccionadas a personas que no han ido a un evento.
--el enunciado está raruno
-- Saca cuantas taquillas se han utilizado en juego libre (tabla acceso).
select taquilla.numero_taquilla "Taquillas", count(usuario.nombre_usuario) "Veces que se utilizo"
    from taquilla, usuario, acceso
	where usuario.dni_usuario = acceso.dni_usuario
		and acceso.numero_taquilla = taquilla.numero_taquilla
    	and not exists (select usuario.dni_usuario from usuario, asiste 
    					where usuario.dni_usuario = asiste.dni_usuario)
	group by taquilla.numero_taquilla;

--sobraba la subconsulta
--CORREGIDA
select taquilla.numero_taquilla "Taquilla", count(usuario.dni_usuario) "Veces que se utilizo"
    from taquilla, usuario, acceso
	where usuario.dni_usuario = acceso.dni_usuario
		and acceso.numero_taquilla = taquilla.numero_taquilla
	group by taquilla.numero_taquilla;


--10 Saca cuantas personas han escogido cada menu, mediante agrupacion (group by). (enunciado modificado)
select menu.nombre_menu "Menús", count(usuario.dni_usuario) "Veces seleccionado"  
    from usuario, menu, asiste, evento
    where usuario.dni_usuario = asiste.dni_usuario
    	and asiste.id_evento = evento.id_evento
    	and evento.id_menu = menu.id_menu
    group by menu.nombre_menu;

--aqui creo que se refiere a juego libre, ya que la gente cuando va a un evento no puede escoger menu
--es el que toca
--CORREGIDO
select menu.nombre_menu "Menús", count(usuario.dni_usuario) "Veces seleccionado"  
    from usuario, menu, acceso
    where usuario.dni_usuario = acceso.dni_usuario
    	and acceso.id_menu = menu.id_menu
    group by menu.nombre_menu;

--11 Cuanto ha sido la suma total de dinero pagado, por cada evento. (enunciado modificado)
select evento.nombre_evento "Eventos", sum(acceso.precio_acceso) "Suma total de dinero"
    from evento, acceso, usuario, asiste
	where usuario.dni_usuario = asiste.dni_usuario
		and asiste.id_evento = evento.id_evento
	group by evento.nombre_evento;
--CORREGIDO
select evento.nombre_evento "Eventos", menu.precio_menu*count(usuario.dni_usuario) "Suma total de dinero"
    from evento, usuario, asiste, menu
	where usuario.dni_usuario = asiste.dni_usuario
		and asiste.id_evento = evento.id_evento
    	and evento.id_menu = menu.id_menu
	group by evento.id_evento,evento.nombre_evento, menu.precio_menu;

--12 Muestra las taquillas, junto a las veces que estan han sido utilizadas. (enunciado modificado)
select taquilla.numero_taquilla "Taquillas", count(usuario.nombre_usuario) "Veces que se utilizó"
    from taquilla, usuario, acceso
	where usuario.dni_usuario = acceso.dni_usuario
		and acceso.numero_taquilla = taquilla.numero_taquilla
	group by taquilla.numero_taquilla
    order by taquilla.numero_taquilla asc;

--muy parecida que la 9 (meditamos si quitarla)


--13 Muestra cuántos tutores tiene un usuario.
select us_tutor.nombre_usuario "Tutor", count(us_normal.dni_usuario) "Personas que tiene a cargo"
	from usuario us_tutor, usuario us_normal, tiene
	where us_tutor.dni_usuario = tiene.dni_usuario
		and us_normal.dni_usuario = tiene.dni_usuario
	group by us_tutor.nombre_usuario;
--están al revés creo
--NUNCA agrupar por nombre, hay que agrupar por la PRIMARY KEY

--14 ¿Y al revés? Muestra cuantos tutores tienen cada usuario. (enunciado modificado)
select us_normal.nombre_usuario "Usuario", count(us_tutor.dni_usuario) "Personas que tiene de tutor"
	from usuario us_normal, usuario us_tutor, tiene
	where us_normal.dni_usuario = tiene.usu_dni_usuario
		and us_tutor.dni_usuario = tiene.dni_usuario
	group by us_normal.nombre_usuario;

--15 Saca el numero de participantes que haya en cada evento con el nombre del evento.
select evento.nombre_evento "Eventos", count(usuario.dni_usuario) "Usuarios asistentes"
    from evento, usuario, asiste
    where usuario.dni_usuario = asiste.dni_usuario
    	and asiste.id_evento = evento.id_evento
    group by evento.id_evento, evento.nombre_evento;

--16 En cuantos eventos en total han participado cada animador (agrupada).
select animacion.nombre_animador "Animadores", count(evento.id_evento) "Eventos en los que participa"
     from animacion, evento, incluye
     where animacion.dni_animador = incluye.dni_animador
    	and evento.id_evento = incluye.id_evento 
     group by animacion.dni_animador, animacion.nombre_animador;

--17 Saca, descendentemente, los menus junto a las veces que han sido escogidos.
-- esta es complicadilla (la reviso bien)
select menu.nombre_menu "Menús", count(usuario.dni_usuario) "Veces seleccionado"  
    from usuario, menu, asiste, evento
    where usuario.dni_usuario = asiste.dni_usuario
    	and asiste.id_evento = evento.id_evento
    	and evento.id_menu = menu.id_menu
    group by menu.nombre_menu
    order by count(usuario.dni_usuario) desc;	

--18 Ahora, saca ascendentemente, las taquillas junto a su uso. (enunciado modificado)
select taquilla.numero_taquilla "Taquillas", count(usuario.nombre_usuario) "Veces que se utilizo"
    from taquilla, usuario, acceso
	where usuario.dni_usuario = acceso.dni_usuario
		and acceso.numero_taquilla = taquilla.numero_taquilla
	group by taquilla.numero_taquilla
	order by taquilla.numero_taquilla asc;

--19 Mostrar las alergias de los usuarios que hay en un evento, es decir, mostrar (agrupadas) los tipos de alergia que hay. 
select evento.nombre_evento "Eventos", count(usuario.alergias_usuario) "Número de alergias del evento"
    from evento, usuario, asiste
    where usuario.dni_usuario = asiste.dni_usuario
    	and asiste.id_evento = evento.id_evento
    group by evento.nombre_evento;
--sacas la cuenta e interesa saber cuáles son
--CORREGIDO
select evento.nombre_evento "Eventos", usuario.alergias_usuario 
    from evento, usuario, asiste
    where usuario.dni_usuario = asiste.dni_usuario
    	and asiste.id_evento = evento.id_evento
    group by evento.id_evento, evento.nombre_evento, usuario.alergias_usuario
    order by evento.id_evento;
--esta está mejor pero no del tutto bien

--20 Mostrar el precio medio de todos los eventos realizados. (mirar)
select evento.nombre_evento "Eventos", avg(acceso.precio_acceso) "Media de precios"
    from evento, acceso, usuario, asiste
	where usuario.dni_usuario = asiste.dni_usuario
		and asiste.id_evento = evento.id_evento
	group by evento.nombre_evento;

--CORREGIDO
select avg(menu.precio_menu*count(usuario.dni_usuario)) "Media de precios"
    from evento, usuario, asiste, menu
	where usuario.dni_usuario = asiste.dni_usuario
		and asiste.id_evento = evento.id_evento
    	and evento.id_menu = menu.id_menu
    group by evento.id_evento, menu.precio_menu;

--21 Mostrar el precio total de los eventos realizados. (Cuantos animadores han sido contratados por evento?????)



--22 Mostrar la media de precio de las personas que acceden a la zona de juego (juego libre).
select zona_juegos.nombre_zonajuego "Zonas de juego", avg(acceso.precio_acceso) "Media de precios"
    from acceso, zona_juegos
	where zona_juegos.id_zonajuego = acceso.id_zonajuego
	group by zona_juegos.nombre_zonajuego;

--23 Muestra la taquilla más usada.  (mirar)
select taquilla.numero_taquilla "Taquillas", count(usuario.nombre_usuario) "Veces que se utilizó"
    from taquilla, usuario, acceso
	where usuario.dni_usuario = acceso.dni_usuario
		and acceso.numero_taquilla = taquilla.numero_taquilla
	group by taquilla.numero_taquilla
    	having (count(usuario.nombre_usuario)) = (max(count(usuario.nombre_usuario)));

--24 Mostrar los eventos junto a toda la gente que participo y asistio, incluido animadores y personal. (enunciado modificado)
select evento.nombre_evento "Eventos", (count(usuario.dni_usuario) + count(animacion.dni_animador) + count(personal.dni_personal)) "Gente que asistió"
    from evento, usuario, asiste, animacion, incluye, acceso, zona_juegos, personal, trabaja
    where usuario.dni_usuario = asiste.dni_usuario
    	and asiste.id_evento = evento.id_evento
	and animacion.dni_animador = incluye.dni_animador
    	and evento.id_evento = incluye.id_evento
	and acceso.id_zonajuego = zona_juegos.id_zonajuego 
	and zona_juegos.id_zonajuego = trabaja.id_zonajuego
	and personal.dni_personal = trabaja.dni_personal
    group by evento.nombre_evento;

-------ENUNCIADOS CONSULTAS (subconsultas)---------------

--25 Mostrar los eventos de un usuario especifico por nombre que no hayan contratado un menu especifico.
select evento.* from usuario, reserva, corresponde, evento where usuario.nombre_usuario like '%Carlos%' 
    and usuario.dni_usuario = reserva.dni_usuario and reserva.id_reserva = corresponde.id_reserva 
    and corresponde.id_evento = evento.id_evento 
    and evento.id_evento not in (select ofrece.id_evento from ofrece);

--26 Mostrar los usuarios que no han reservado ningún evento.
select usuario.* from usuario where usuario.dni_usuario 
    not in (select reserva.dni_usuario from reserva);

--27 Mostrar el usuario con mayor numero de eventos organizados.
select usuario.nombre_usuario from usuario,reserva 
where usuario.dni_usuario = reserva.dni_usuario 
group by reserva.dni_usuario, usuario.nombre_usuario 
having count(*) = (select max(count(*)) from reserva group by reserva.dni_usuario);

--28 Mostrar al animador en el que más eventos ha animado.
select animacion.nombre_animador from animacion,incluye
where incluye.dni_animador = animacion.dni_animador
group by incluye.dni_animador, animacion.nombre_animador 
having count(*) = (select max(count(*)) from incluye group by incluye.dni_animador);

--29 Mostrar el numero de taquilla de un usuario específico en una fecha determinada.
select numero_taquilla from acceso 
    where dni_usuario = (select dni_usuario from usuario where nombre_usuario like 'Belen Villa') 
    and fecha_acceso = '07/MAY/2022';

--30 Mostrar los usuarios que no han accedido, ni reservado, ningún evento
select dni_usuario, nombre_usuario from usuario where dni_usuario not in (select dni_usuario from reserva) 
    and not exists (select * from asiste,usuario where usuario.dni_usuario = asiste.dni_usuario);

--31 Mostrar de los usuarios el nombre y sus tutores (nombre) que hayan tenido una taquilla en específico y hayan accedido por juego libre.
select usu.nombre_usuario, tut.nombre_usuario, acceso.numero_taquilla 
    from usuario usu,tiene,usuario tut,acceso where tut.dni_usuario = tiene.dni_usuario 
    and usu.dni_usuario = tiene.usu_dni_usuario and acceso.dni_usuario = usu.dni_usuario;

--32 Mostrar la información del menú que más se haya pedido en los eventos.
select menu.*, count(*) "Numero de veces pedido" from menu,evento 
    where evento.id_menu = menu.id_menu group by menu.id_menu, menu.nombre_menu, menu.precio_menu 
    having count(*) = (select max(count(*)) from evento group by evento.id_menu)selec

--33 Mostrar el menú que más se escogió en una fecha determinada, entrando por juego libre. 
select menu.*, count(*) from acceso,menu where acceso.id_menu=menu.id_menu
    and acceso.fecha_acceso = '07/MAY/2022'
    group by menu.id_menu, menu.nombre_menu, menu.precio_menu
    having count(*) in (select max(count(*)) from acceso 
    					where acceso.fecha_acceso = '07/MAY/2022' group by id_menu);

--34 Mostrar los menus que han escogido los usuarios menores de edad y que están tutorizados por 2 personas.
/*METER DATOS GUACHIPIRULIS*/
select * from acceso,usuario where acceso.dni_usuario = usuario.dni_usuario 
    and usuario.dni_usuario in (select usu.dni_usuario 
    from usuario usu, tiene, usuario tut where usu.dni_usuario = tiene.usu_dni_usuario 
    and tiene.dni_usuario = tut.dni_usuario group by tut.dni_usuario, usu.dni_usuario having count(*) = 2);


------ENUNCIADOS CONSULTAS (Outer Join)---------------

--35 Mostrar todos los usuarios junto al nombre de los que tienen a su cargo, mostrando también los que no tienen ninguno a su cargo.

--36 Mostrar la informacion sobre el menu y los animadores junto a cada evento, mostrando 'Sin animador' si no ha habido animación.

--37 Mostrar los eventos que hayan sido cumpleaños.

-------ENUNCIADOS CONSULTAS (Inserciones)---------------

--38 Insertar en una nueva tabla ALERGIAS, las alergias de los usuarios sin repetir.

--39 Insertar un nuevo monitor con el nombre Julián Álvarez que viva en la misma calle que Juan Pérez.

-------ENUNCIADOS CONSULTAS (Updates)---------------

--40 Todos los usuarios que no tengan ninguna alergia, actualizan su valor a ‘Sin Alergia’.

--41 Subir el precio del menú menos vendido en los eventos un 5 %.

--42 Aplazar la fecha de un evento especificado 1 semana.
